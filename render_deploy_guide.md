# Руководство по деплою проекта "Ломбард" на Render

## Предварительные шаги

1. **Регистрация на Render**
   - Перейдите на [render.com](https://render.com)
   - Зарегистрируйтесь (можно через GitHub)

2. **Подготовка проекта**
   - Убедитесь, что проект находится в Git-репозитории (GitHub, GitLab или Bitbucket)
   - В проекте уже созданы все необходимые файлы конфигурации:
     - `render.yaml`
     - `src/backend/requirements.txt` (с добавленным gunicorn)
     - `src/config.js` (настроен для работы с Render)

## Деплой проекта через Blueprint

1. **Перейдите в дашборд Render и нажмите "New"**

2. **Выберите "Blueprint"**
   - Это позволит развернуть сразу и бэкенд, и фронтенд из файла конфигурации

3. **Подключите Git-репозиторий с проектом**

4. **Настройте переменные окружения**:
   - При создании blueprintа у вас запросят значения для переменных, отмеченных как `sync: false`:
     - `DB_PASSWORD`: пароль вашей существующей PostgreSQL базы данных
     - `DB_HOST`: адрес вашей существующей PostgreSQL базы данных

5. **Нажмите "Apply Blueprint"**
   - Render создаст все необходимые сервисы из файла `render.yaml`

## Проверка деплоя

1. **Дождитесь завершения деплоя всех сервисов**
   - Обычно это занимает 5-10 минут для первого деплоя

2. **Проверьте логи бэкенд-сервиса**
   - Перейдите в сервис "lombard-backend"
   - Откройте вкладку "Logs"
   - Убедитесь, что нет ошибок и приложение запущено успешно

3. **Проверьте работу фронтенда**
   - Перейдите по URL вашего фронтенд-сервиса (будет указан в дашборде)
   - Проверьте функциональность приложения

## Что делать при ошибках подключения к базе данных

1. **Проверьте параметры подключения**
   - В дашборде Render перейдите в сервис "lombard-backend"
   - Откройте вкладку "Environment"
   - Проверьте правильность переменных DB_HOST, DB_USER, DB_PASSWORD и др.

2. **Убедитесь, что ваша база данных доступна извне**
   - Настройки firewall/security group должны разрешать подключения с IP-адресов Render
   - Для PostgreSQL проверьте файл `pg_hba.conf` и настройки `listen_addresses`

3. **Запустите диагностический скрипт**
   - Откройте Shell для сервиса "lombard-backend"
   - Выполните команду: `python src/backend/render_setup.py`

## Настройка собственного домена (по желанию)

1. **Добавьте домен в настройках сервиса**
   - Перейдите в сервис "lombard-frontend"
   - Откройте вкладку "Settings" → "Custom Domain"
   - Следуйте инструкциям для настройки DNS

## Обновление приложения

После изменений в репозитории:

1. **Сделайте push в Git-репозиторий**
2. **Render автоматически запустит новый деплой**

## Дополнительная информация

- Все сервисы размещены на бесплатном плане, который имеет ограничения:
  - Ограниченные вычислительные ресурсы
  - Сервисы "засыпают" при неактивности
  - Ограниченное число запросов в месяц
  
- Для продакшн-окружения рекомендуется перейти на платный план. 